<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Article page</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color-scheme: light dark; }
    body { margin: 0; padding: 2rem; }
    main { max-width: 820px; margin: 0 auto; }
    code { padding: .1rem .3rem; border-radius: .3rem; background: color-mix(in oklab, Canvas 92%, CanvasText 8%); }
  </style>
</head>
<body>
  <main>
    <h1 id="title">Article page (waiting 500 ms…)</h1>
    <p><a href="./index.html">Home</a></p>
    <p>Status: <code id="status">initial</code></p>
  </main>

  <script>
    console.log('[Article] Script loaded');

    window.onload = function() {
      console.log('[Article] onload fired — waiting 500ms before history manipulation');
      const BASE = location.pathname.replace(/\/[^\/]*$/, '/');
      const HOME = BASE + 'index.html';
      const title = document.getElementById('title');
      const statusEl = document.getElementById('status');

      window.addEventListener('popstate', function() {
        console.log('[Article] popstate fired — redirecting to homepage');
        location.replace(HOME);
      });

      setTimeout(() => {
        console.log('[Article] Attempting to modify history after 500ms');
        try {
          history.replaceState({ trap: true, at: Date.now() }, '', location.href);
          history.pushState({ trap: true, guard: true, at: Date.now() }, '', location.href);
          title.textContent = 'Article page (history hacked)';
          statusEl.textContent = 'history hacked after 500ms';
          console.log('[Article] History successfully modified');
        } catch (e) {
          title.textContent = 'Article page (failed to hack)';
          statusEl.textContent = 'failed: ' + (e && e.message ? e.message : e);
          console.error('[Article] Failed to modify history:', e);
        }
      }, 500);
    };
  </script>
</body>
</html>
